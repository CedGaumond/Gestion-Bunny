@page "/employee-detail/{IdString}"
@using Gestion_Bunny.Modeles
@using Gestion_Bunny.Services
@inject NavigationManager Navigation
@inject IUserService UserService
@inject PageTitleService TitleService

<div class="container d-flex justify-content-center mt-4">
    <div class="card shadow bg-dark text-white" style="max-width: 800px; margin: 0 auto;">
        <div class="card-body overflow-auto">

            @if (user != null)
            {
                <!-- Photo de profil -->
                <div class="d-flex justify-content-center mb-4">
                    @if (user.Employee?.Pic != null && user.Employee.Pic.Length > 0)
                    {
                        <img src="@($"data:image/png;base64,{Convert.ToBase64String(user.Employee.Pic)}")"
                             class="rounded-circle border border-light"
                             alt="Photo de profil"
                             style="width: 150px; height: 150px; object-fit: cover;" />
                    }
                    else
                    {
                        <img src="/images/default-profile.png"
                             class="rounded-circle border border-light"
                             alt="Photo de profil par défaut"
                             style="width: 150px; height: 150px; object-fit: cover;" />
                    }
                </div>

                <!-- Informations de l'utilisateur -->
                <div class="text-center">
                    <h4 class="fw-bold">@user.FirstName @user.LastName</h4>
                    <p class="text-secondary">@user.UserRole?.RoleName</p>
                </div>

                <hr class="bg-light" />

                <div class="mb-3">
                    <strong>Email :</strong>
                    <span>@user.Email</span>
                </div>

                @if (user.Employee != null)
                {
                    <div class="mb-3">
                        <strong>Date de naissance :</strong>
                        <span>@(user.Employee.BirthDate?.ToString("dd MMM yyyy") ?? "Non renseigné")</span>
                    </div>

                    <div class="mb-3">
                        <strong>Numéro d'assurance sociale :</strong>
                        <span>@(user.Employee.SocialInsuranceNumber ?? "Non renseigné")</span>
                    </div>

                    <div class="mb-3">
                        <strong>Adresse :</strong>
                        <span>@(user.Employee.Address ?? "Non renseignée")</span>
                    </div>
                }

                <!-- Boutons d'actions -->
                <div class="d-flex justify-content-center mt-4 gap-3">
                    <button type="button" class="btn btn-light px-4" @onclick="@(() => Navigation.NavigateTo("/employee-list"))">
                        Retour
                    </button>
                    <button type="button" class="btn btn-warning px-4" @onclick="ResetPassword">
                        Réinitialiser le mot de passe
                    </button>
                </div>
            }
            else
            {
                <p class="text-center">Chargement des informations...</p>
            }
        </div>
    </div>
</div>

@code {
    [Parameter] public string? IdString { get; set; }
    private int? Id => int.TryParse(IdString, out var id) ? id : null;

    private User? user;

    protected override async Task OnInitializedAsync()
    {
        TitleService.Title = "Détail de l'Utilisateur";

        if (Id.HasValue)
        {
            user = await UserService.GetUserByIdAsync(Id.Value);
        }
    }

    private async Task ResetPassword()
    {
        if (user != null)
        {
            await UserService.ResetPasswordAsync(user.Id);
            Navigation.NavigateTo("/employee-list");
        }
    }
}
